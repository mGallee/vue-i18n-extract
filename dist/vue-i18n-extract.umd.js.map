{"version":3,"file":"vue-i18n-extract.umd.js","sources":["../src/report-command/vue-files.ts","../src/report-command/language-files.ts","../src/report-command/report.ts","../src/report-command/index.ts","../src/init-command/index.ts","../src/index.ts"],"sourcesContent":["import { SimpleFile, I18NItem } from '../types';\nimport isValidGlob from 'is-valid-glob';\nimport glob from 'glob';\nimport fs from 'fs';\n\nexport function readVueFiles (src: string): SimpleFile[] {\n  if (!isValidGlob(src)) {\n    throw new Error(`vueFiles isn't a valid glob pattern.`);\n  }\n\n  const targetFiles = glob.sync(src);\n\n  if (targetFiles.length === 0) {\n    throw new Error('vueFiles glob has no files.');\n  }\n\n  return targetFiles.map((f) => {\n    const fileName = f.replace(process.cwd(), '');\n    return { fileName, path: f, content: fs.readFileSync(f, 'utf8') };\n  });\n}\n\nfunction* getMatches (file: SimpleFile, regExp: RegExp, captureGroup = 1): IterableIterator<I18NItem> {\n  while (true) {\n    const match = regExp.exec(file.content);\n    if (match === null) {\n      break;\n    }\n    const line = (file.content.substring(0, match.index).match(/\\n/g) || []).length + 1;\n    yield {\n      path: match[captureGroup],\n      line,\n      file: file.fileName,\n    };\n  }\n}\n\n/**\n * Extracts translation keys from methods such as `$t` and `$tc`.\n *\n * - **regexp pattern**: (?:[$ .]tc?)\\(\n *\n *   **description**: Matches the sequence t( or tc(, optionally with either “$”, “.” or “ ” in front of it.\n *\n * - **regexp pattern**: ([\"'`])\n *\n *   **description**: 1. capturing group. Matches either “\"”, “'”, or “`”.\n *\n * - **regexp pattern**: ((?:[^\\\\]|\\\\.)*?)\n *\n *   **description**: 2. capturing group. Matches anything except a backslash\n *   *or* matches any backslash followed by any character (e.g. “\\\"”, “\\`”, “\\t”, etc.)\n *\n * - **regexp pattern**: \\1\n *\n *   **description**: matches whatever was matched by capturing group 1 (e.g. the starting string character)\n *\n * @param file a file object\n * @returns a list of translation keys found in `file`.\n */\n function extractMethodMatches (file: SimpleFile): I18NItem[] {\n  const methodRegExp = /(?:[$ .\"]tc?)\\(\\s*?([\"'`])((?:[^\\\\]|\\\\.)*?)\\1/g;\n  return [ ...getMatches(file, methodRegExp, 2) ];\n}\n\nfunction extractComponentMatches (file: SimpleFile): I18NItem[] {\n  const componentRegExp = /(?:<i18n)(?:.|\\n)*?(?:[^:]path=(\"|'))(.*?)\\1/gi;\n  return [ ...getMatches(file, componentRegExp, 2) ];\n}\n\nfunction extractDirectiveMatches (file: SimpleFile): I18NItem[] {\n  const directiveRegExp = /v-t=\"'(.*?)'\"/g;\n  return [ ...getMatches(file, directiveRegExp) ];\n}\n\nfunction extractI18nItemsFromVueFiles (sourceFiles: SimpleFile[]): I18NItem[] {\n  return sourceFiles.reduce((accumulator, file) => {\n    const methodMatches = extractMethodMatches(file);\n    const componentMatches = extractComponentMatches(file);\n    const directiveMatches = extractDirectiveMatches(file);\n    return [\n      ...accumulator,\n      ...methodMatches,\n      ...componentMatches,\n      ...directiveMatches,\n    ];\n  }, [] as I18NItem[]);\n}\n\nexport function parseVueFiles (vueFilesPath: string): I18NItem[] {\n  const filesList = readVueFiles(vueFilesPath);\n  return extractI18nItemsFromVueFiles(filesList);\n}\n","import path from 'path';\nimport fs from 'fs';\nimport glob from 'glob';\nimport dot from 'dot-object';\nimport yaml from 'js-yaml';\nimport isValidGlob from 'is-valid-glob';\nimport { LanguageFile, I18NLanguage, I18NItem } from '../types';\n\nfunction readLangFiles (src: string): LanguageFile[] {\n  if (!isValidGlob(src)) {\n    throw new Error(`languageFiles isn't a valid glob pattern.`);\n  }\n\n  const targetFiles = glob.sync(src);\n\n  if (targetFiles.length === 0) {\n    throw new Error('languageFiles glob has no files.');\n  }\n\n  return targetFiles.map(f => {\n    const langPath = path.resolve(process.cwd(), f);\n\n    const extension = langPath.substring(langPath.lastIndexOf('.')).toLowerCase();\n    const isJSON = extension === '.json';\n    const isYAML = extension === '.yaml' || extension === '.yml';\n\n    let langObj;\n    if (isJSON) {\n      langObj = JSON.parse(fs.readFileSync(langPath, 'utf8'));\n    } else if (isYAML) {\n      langObj = yaml.safeLoad(fs.readFileSync(langPath, 'utf8'));\n    } else {\n      langObj = eval(fs.readFileSync(langPath, 'utf8'));\n    }\n\n    const fileName = f.replace(process.cwd(), '');\n\n    return { fileName, path: f, content: langObj };\n  });\n}\n\nfunction extractI18nItemsFromLanguageFiles (languageFiles: LanguageFile[]): I18NLanguage {\n  return languageFiles.reduce((accumulator, file) => {\n    const language = file.fileName.substring(file.fileName.lastIndexOf('/') + 1, file.fileName.lastIndexOf('.'));\n\n    if (!accumulator[language]) {\n      accumulator[language] = [];\n    }\n\n    const flattenedObject = dot.dot(file.content);\n    Object.keys(flattenedObject).forEach((key, index) => {\n      accumulator[language]?.push({\n        line: index,\n        path: key,\n        file: file.fileName,\n      });\n    });\n\n    return accumulator;\n  }, {});\n}\n\nexport class LanguageFileUpdater {\n  languageFiles: LanguageFile[];\n  hasChanges = false;\n\n  constructor(languageFiles: string) {\n    this.languageFiles = readLangFiles(path.resolve(process.cwd(), languageFiles));\n  }\n\n  addMissingKeys(missingKeys: I18NItem[]): void {\n    this.hasChanges = true;\n    this.languageFiles.forEach(languageFile => {\n      missingKeys.forEach(item => {\n        if (item.language && languageFile.fileName.includes(item.language) || !item.language) {\n          dot.str(item.path, '', languageFile.content);\n        }\n      });\n    });\n  }\n\n  removeUnusedKeys(unusedKeys: I18NItem[]): void {\n    this.hasChanges = true;\n    this.languageFiles.forEach(languageFile => {\n      unusedKeys.forEach(item => {\n        if (item.language && languageFile.fileName.includes(item.language)) {\n          dot.delete(item.path, languageFile.content);\n        }\n      });\n    });\n  }\n\n  writeChanges(): void {\n    this.languageFiles.forEach(languageFile => {\n      new FileAccessLayer(languageFile.path).write(languageFile.content);\n    });\n  }\n}\n\n\nclass FileAccessLayer {\n  path: string;\n\n  constructor(path: string) {\n    this.path = path;\n  }\n\n  write(content: Record<string, unknown>) {\n    const rawJSON = JSON.stringify(content, null, 2);\n    const endsWith = ext => this.path.endsWith(`.${ext}`);\n    let stringifiedContent = \"\";\n\n    if (endsWith('json')) {\n      stringifiedContent = rawJSON;\n    } else if (endsWith('js')) {\n      stringifiedContent = `export default ${stringifiedContent}; \\n`;\n    } else if (endsWith('yaml') || endsWith('yml')) {\n      stringifiedContent = yaml.safeDump(content);\n    } else {\n      throw new Error('Filetype not supported.')\n    }\n    fs.writeFileSync(this.path, stringifiedContent);\n  }\n  // TODO: Move reading into this class\n}\n\nexport function parseLanguageFiles (languageFilesPath: string): I18NLanguage {\n  const filesList = readLangFiles(languageFilesPath);\n  return extractI18nItemsFromLanguageFiles(filesList);\n}\n","import fs from 'fs';\nimport { I18NItem, I18NLanguage, I18NReport } from '../types';\n\nexport enum VueI18NExtractReportTypes {\n  None = 0,\n  Missing = 1 << 0,\n  Unused = 1 << 1,\n  Dynamic = 1 << 2,\n  All = ~(~0 << 3)\n};\n\nconst mightBeUsedDynamically = function (languageItem: I18NItem, dynamicKeys: I18NItem[]): boolean {\n  return dynamicKeys.some(dynamicKey => languageItem.path.includes(dynamicKey.path));\n}\n\nexport function extractI18NReport (parsedVueFiles: I18NItem[], parsedLanguageFiles: I18NLanguage, reportType: VueI18NExtractReportTypes = VueI18NExtractReportTypes.Missing + VueI18NExtractReportTypes.Unused): I18NReport {\n  const missingKeys: I18NItem[] = [];\n  const unusedKeys: I18NItem[] = [];\n  const dynamicKeys: I18NItem[] = [];\n  const dynamicReportEnabled = reportType & VueI18NExtractReportTypes.Dynamic;\n\n  Object.keys(parsedLanguageFiles).forEach(language => {\n    let languageItems = parsedLanguageFiles[language];\n\n    parsedVueFiles.forEach(vueItem => {\n      const usedByVueItem = function (languageItem: I18NItem): boolean {\n        return languageItem.path === vueItem.path || languageItem.path.startsWith(vueItem.path + '.');\n      }\n\n      if (dynamicReportEnabled && (vueItem.path.includes('${') || vueItem.path.endsWith('.'))) {\n        dynamicKeys.push(({ ...vueItem, language }))\n        return\n      }\n\n      if (!parsedLanguageFiles[language].some(usedByVueItem)) {\n        missingKeys.push(({ ...vueItem, language }));\n      }\n\n      languageItems = languageItems.filter(languageItem => dynamicReportEnabled ?\n        !mightBeUsedDynamically(languageItem, dynamicKeys) && !usedByVueItem(languageItem) :\n        !usedByVueItem(languageItem));\n    });\n\n    unusedKeys.push(...languageItems.map((item) => ({ ...item, language })));\n  });\n\n  let extracts = {};\n  if (reportType & VueI18NExtractReportTypes.Missing) {\n    extracts = Object.assign(extracts, { missingKeys });\n  }\n  if (reportType & VueI18NExtractReportTypes.Unused) {\n    extracts = Object.assign(extracts, { unusedKeys });\n  }\n  if (dynamicReportEnabled) {\n    extracts = Object.assign(extracts, { dynamicKeys });\n  }\n\n  return extracts;\n}\n\nexport async function writeReportToFile (report: I18NReport, writePath: string): Promise<NodeJS.ErrnoException | void> {\n  const reportString = JSON.stringify(report);\n  return new Promise((resolve, reject) => {\n    fs.writeFile(\n      writePath,\n      reportString,\n      (err) => {\n        if (err) {\n          reject(err);\n          return;\n        }\n        resolve();\n      },\n    );\n  });\n}\n\n","import path from 'path';\nimport fs from 'fs';\n\nimport { ReportOptions, I18NReport } from '../types';\nimport { parseVueFiles } from './vue-files';\nimport { parseLanguageFiles, LanguageFileUpdater } from './language-files';\nimport { extractI18NReport, VueI18NExtractReportTypes, writeReportToFile } from './report';\n\nexport function createI18NReport (vueFiles: string, languageFiles: string, command: ReportOptions): I18NReport {\n  const resolvedVueFiles = path.resolve(process.cwd(), vueFiles);\n  const resolvedLanguageFiles = path.resolve(process.cwd(), languageFiles);\n\n  const parsedVueFiles = parseVueFiles(resolvedVueFiles);\n  const parsedLanguageFiles = parseLanguageFiles(resolvedLanguageFiles);\n\n  const reportType = command.dynamic ? VueI18NExtractReportTypes.All : (VueI18NExtractReportTypes.Missing + VueI18NExtractReportTypes.Unused);\n\n  return extractI18NReport(parsedVueFiles, parsedLanguageFiles, reportType);\n}\n\nexport function reportFromConfigCommand(): Promise<void> | void {\n  try {\n    const configFile = eval(fs.readFileSync(path.resolve(process.cwd(), 'vue-i18n-extract.config.js'), 'utf8'));\n    return reportCommand({\n      vueFiles: configFile.vueFilesPath,\n      languageFiles: configFile.languageFilesPath,\n      ...(configFile.options.output && {output: configFile.options.output }),\n      ...(configFile.options.add && { add: Boolean(configFile.options.add) }),\n      ...(configFile.options.dynamic && {dynamic: [false, 'ignore', 'report'].findIndex(e => e === configFile.options.dynamic) }),\n    });\n  } catch (err) {\n    console.error(err);\n  }\n}\n\nexport async function reportCommand (command: ReportOptions): Promise<void> {\n  const { vueFiles, languageFiles, output, add, remove, dynamic, ci } = command;\n  console.log(vueFiles);\n  const report = createI18NReport(vueFiles, languageFiles, command);\n  const updater = new LanguageFileUpdater(languageFiles);\n\n  if (report.missingKeys) console.info('missing keys: '), console.table(report.missingKeys);\n  if (report.unusedKeys) console.info('unused keys: '), console.table(report.unusedKeys);\n  if (report.dynamicKeys && dynamic && dynamic > 1) console.info('dynamic detected keys: '), console.table(report.dynamicKeys);\n\n  if (output) {\n    await writeReportToFile(report, path.resolve(process.cwd(), output));\n    console.log(`The report has been has been saved to ${output}`);\n  }\n\n  if (add && report.missingKeys && report.missingKeys.length > 0) {\n    updater.addMissingKeys(report.missingKeys);\n    console.log('The missing keys have been added');\n  }\n\n  if (remove && report.unusedKeys && report.unusedKeys.length > 0) {\n    updater.removeUnusedKeys(report.unusedKeys);\n    console.log('The unused keys have been removed');\n  }\n\n  if (updater.hasChanges) {\n    updater.writeChanges();\n    console.log('Language files have been updated');\n  }\n\n  if (ci && Object.prototype.hasOwnProperty.call(report, 'missingKeys') && report.missingKeys !== undefined) {\n    const exitCode = report.missingKeys.length > 0 ? 1 : 0;\n    console.log(`[vue-i18n-extract] ${report.missingKeys.length} missing keys found.`);\n    process.exit(exitCode);\n  }\n}\n\nexport * from './vue-files';\nexport * from './language-files';\nexport * from './report';\n","import fs from 'fs';\n\nconst configFile = `\nmodule.exports = {\n  vueFilesPath: './', // The Vue.js file(s) you want to extract i18n strings from. It can be a path to a folder or to a file. It accepts glob patterns. (ex. *, ?, (pattern|pattern|pattern)\n  languageFilesPath: './', // The language file(s) you want to compare your Vue.js file(s) to. It can be a path to a folder or to a file. It accepts glob patterns (ex. *, ?, (pattern|pattern|pattern)\n  options: {\n    output: false, // false | string => Use if you want to create a json file out of your report. (ex. output.json)\n    add: false, // false | true => Use if you want to add missing keys into your json language files.\n    dynamic: false, // false | 'ignore' | 'report' => 'ignore' if you want to ignore dynamic keys false-positive. 'report' to get dynamic keys report.\n  }\n};\n`;\n\nexport function initCommand(): void {\n  fs.writeFileSync('vue-i18n-extract.config.js', configFile);\n}\n\n","import * as report from './report-command';\n\nexport * from './init-command';\n\nexport * from './types';\nexport * from './report-command';\n\n// Needed for compatibility with versions < 1.1.0 of vue-i18n-extract.\nexport default {\n  ...report\n};\n"],"names":["readVueFiles","src","isValidGlob","Error","targetFiles","glob","sync","length","map","f","fileName","replace","process","cwd","path","content","fs","readFileSync","getMatches","file","regExp","captureGroup","match","exec","line","substring","index","extractMethodMatches","methodRegExp","extractComponentMatches","componentRegExp","extractDirectiveMatches","directiveRegExp","extractI18nItemsFromVueFiles","sourceFiles","reduce","accumulator","methodMatches","componentMatches","directiveMatches","parseVueFiles","vueFilesPath","filesList","readLangFiles","langPath","resolve","extension","lastIndexOf","toLowerCase","isJSON","isYAML","langObj","JSON","parse","yaml","safeLoad","eval","extractI18nItemsFromLanguageFiles","languageFiles","language","flattenedObject","dot","Object","keys","forEach","key","push","LanguageFileUpdater","constructor","addMissingKeys","missingKeys","hasChanges","languageFile","item","includes","str","removeUnusedKeys","unusedKeys","delete","writeChanges","FileAccessLayer","write","rawJSON","stringify","endsWith","ext","stringifiedContent","safeDump","writeFileSync","parseLanguageFiles","languageFilesPath","VueI18NExtractReportTypes","mightBeUsedDynamically","languageItem","dynamicKeys","some","dynamicKey","extractI18NReport","parsedVueFiles","parsedLanguageFiles","reportType","Missing","Unused","dynamicReportEnabled","Dynamic","languageItems","vueItem","usedByVueItem","startsWith","filter","extracts","assign","writeReportToFile","report","writePath","reportString","Promise","reject","writeFile","err","createI18NReport","vueFiles","command","resolvedVueFiles","resolvedLanguageFiles","dynamic","All","reportFromConfigCommand","configFile","reportCommand","options","output","add","Boolean","findIndex","e","console","error","remove","ci","log","updater","info","table","prototype","hasOwnProperty","call","undefined","exitCode","exit","initCommand"],"mappings":"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"}